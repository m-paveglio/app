<p-confirmDialog></p-confirmDialog>
<p-toast></p-toast>
<div class="grid" *ngIf="novaEmpresa">
    <div class="col-12">
        <div *ngIf="!resultado" class="p-inputtext p-component p-element">


    <!-- Formulário de consulta CPF e nome -->
    <h3 class="text-center" [ngStyle]="{backgroundColor:'var(--cyan-800)', color: 'var(--primary-color-text)', borderRadius: 'var(--border-radius)'}">
        CONSULTAR EMPRESA
    </h3>
    <form (ngSubmit)="buscarEmpresa()"> <!-- Envolva tudo no formulário -->
        <div class="p-fluid p-formgrid grid" style="margin-top: 20px">
            <!-- Campo de CPF -->
            <div class="field col-12 md:col-4">
                <span class="p-float-label">
                    <input id="CNPJ-input" type="text" pinputtext="" class="p-inputtext p-component p-element p-filled" 
                           mask="00.000.000/0000-00" [(ngModel)]="CNPJ" name="CNPJ" (keydown.enter)="buscarEmpresa()">
                    <label for="CNPJ-input">CNPJ</label>
                </span>
            </div>
    
            <!-- Campo de Nome -->
            <div class="field col-12 md:col-7">
                <span class="p-float-label">
                    <input id="NOME-input" type="text" pinputtext="" class="p-inputtext p-component p-element p-filled" 
                           [(ngModel)]="NOME" name="NOME" (keydown.enter)="buscarEmpresa()">
                    <label for="NOME-input">RAZÃO SOCIAL</label>
                </span>
            </div>
    
            <!-- Botão de busca -->
            <div class="btn-group field col-12 md:col-1 flex flex-wrap gap-3" role="group" aria-label="Third group">
                <p-button icon="pi pi-search" severity="success" (click)="buscarEmpresa()"></p-button>
            </div>
        </div>
    </form>
        </div>

        <div *ngIf="EmpresasEncontradas.length > 0" class="p-inputtext p-component p-element" style="margin-top: 20px;">
            <h3 class="text-center" [ngStyle]="{backgroundColor:'var(--cyan-800)', color: 'var(--primary-color-text)', borderRadius: 'var(--border-radius)'}">
                SELECIONAR EMPRESA
            </h3>
            <p-table
                [value]="EmpresasEncontradas"
                [paginator]="true"
                [rows]="5"
                [tableStyle]="{ 'min-width': '50rem' }"
                [rowsPerPageOptions]="[5, 10, 20]"
            >
                <ng-template pTemplate="header">
                    <tr>
                        <th class="field col-12 md:col-3">CNPJ</th> <!-- Usando grid aqui -->
                        <th class="field col-12 md:col-3">IM</th>
                        <th class="field col-12 md:col-6">RAZÃO SOCIAL</th> <!-- Ajustando com 'md:col-x' -->
                        <th class="field col-12 md:col-2">OPTANTE SIMPLES NACIONAL</th> <!-- Ajustando com 'md:col-x' -->
                        <th class="field col-12 md:col-1">Ação</th> <!-- Coluna menor para ação -->
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-empresa>
                    <tr>
                        <td>{{ empresa.CNPJ | mask: '00.000.000/0000-00' }}</td>
                        <td>{{ empresa.IM }}</td>
                        <td>{{ empresa.NOME }}</td>
                        <td>{{ empresa.OPTANTE_SN }}</td>
                        <td>
                            <p-button icon="pi pi-check" severity="success" (click)="selecionarEmpresa(empresa)"></p-button>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>

        <div *ngIf="resultado" class="p-inputtext p-component p-element">
            <h3 class="text-center" [ngStyle]="{backgroundColor:'var(--cyan-800)', color: 'var(--primary-color-text)', borderRadius: 'var(--border-radius)'}"> DADOS PRELIMINARES</h3>
            <div class="p-fluid p-formgrid grid" style="margin-top: 20px">
                <!-- Campo CNPJ -->
                <div class="field col-12 md:col-2">
                    <span class="p-float-label float-label-fixed">
                        
                        <input id="resultado-CNPJ" type="text" pinputtext="" class="p-inputtext p-component p-element"
                               [ngClass]="{ 'p-filled': !editMode }"
                               [style.backgroundColor]="editMode ? 'white' : 'lightgray'"
                               mask='00.000.000/0000-00' [(ngModel)]="resultado.CNPJ" name="CNPJ" [readonly]="!editMode">
                               <label for="resultado-CNPJ">CNPJ</label>
                    </span>
                </div>

                <div class="field col-12 md:col-2">
                    <span class="p-float-label float-label-fixed">
                        
                        <input id="resultado-IM" type="text" pinputtext="" class="p-inputtext p-component p-element"
                               [ngClass]="{ 'p-filled': !editMode }"
                               [style.backgroundColor]="editMode ? 'white' : 'lightgray'"
                               [(ngModel)]="resultado.IM" name="IM" [readonly]="!editMode">
                               <label for="resultado-IM">IM</label>
                    </span>
                </div>
  
                <!-- Campo Nome -->
                <div class="field col-12 md:col-4">
                    <span class="p-float-label float-label-fixed">
                        
                        <input id="resultado-NOME" type="text" pinputtext="" class="p-inputtext p-component p-element"
                               [ngClass]="{ 'p-filled': !editMode }"
                               [style.backgroundColor]="editMode ? 'white' : 'lightgray'"
                               [(ngModel)]="resultado.NOME" name="NOME" [readonly]="!editMode">
                               <label for="resultado-NOME">RAZÃO SOCIAL</label>
                    </span>
                </div> 


                <div class="field col-12 md:col-2">
                    <span class="p-float-label float-label-fixed">
                        <!-- Campo de entrada que aparece somente quando editMode é falso -->
                        <input
                            *ngIf="!editMode"
                            id="resultado-OPTANTE_SN"
                            type="text"
                            pinputtext
                            class="p-inputtext p-component p-element"
                            [ngClass]="{ 'p-filled': true }"
                            [style.backgroundColor]="'lightgray'"
                            [value]="getOptanteSN(resultado.OPTANTE_SN)"
                            readonly>  <!-- Campo somente leitura -->
                        <label for="resultado-OPTANTE_SN">Optante Super Simples</label>
                    </span>
                
                    <!-- Dropdown que aparece somente quando editMode é verdadeiro -->
                    <p-dropdown
                        *ngIf="editMode"
                        id="OPTANTE_SN-dropdown"
                        [options]="OPTANTE_SN"
                        [(ngModel)]="resultado.OPTANTE_SN"
                        optionLabel="nome"
                        optionValue="codigo"
                        placeholder="Selecione"
                        (onChange)="OPTANTE_SN_nome = getOptanteSN(resultado.OPTANTE_SN)">
                    </p-dropdown>
                </div>

                <div class="field col-12 md:col-2">
                  <span class="p-float-label float-label-fixed">
                      <!-- Campo de entrada que aparece somente quando editMode é falso -->
                      <input
                          *ngIf="!editMode"
                          id="resultado-OPTANTE_MEI"
                          type="text"
                          pinputtext
                          class="p-inputtext p-component p-element"
                          [ngClass]="{ 'p-filled': true }"
                          [style.backgroundColor]="'lightgray'"
                          [value]="getOptanteSN(resultado.OPTANTE_MEI)"
                          readonly>  <!-- Campo somente leitura -->
                      <label for="resultado-OPTANTE_MEI">Optante Super Simples</label>
                  </span>
              
                  <!-- Dropdown que aparece somente quando editMode é verdadeiro -->
                  <p-dropdown
                      *ngIf="editMode"
                      id="OPTANTE_MEI-dropdown"
                      [options]="OPTANTE_MEI"
                      [(ngModel)]="resultado.OPTANTE_MEI"
                      optionLabel="nome"
                      optionValue="codigo"
                      placeholder="Selecione"
                      (onChange)="OPTANTE_MEI_nome = getOptanteSN(resultado.OPTANTE_MEI)">
                  </p-dropdown>
              </div>

                <div class="field col-12 md:col-2">
                    <span class="p-float-label float-label-fixed">
                        <!-- Modo visualização -->
                        <input
                            *ngIf="!editMode"
                            id="resultado-AMBIENTE_INTEGRACAO"
                            type="text"
                            pinputtext
                            class="p-inputtext p-component p-element"
                            [ngClass]="{ 'p-filled': true }"
                            [style.backgroundColor]="'lightgray'"
                            [value]="getNomeWebservice(resultado.AMBIENTE_INTEGRACAO_ID)"
                            readonly>
                        <label for="resultado-AMBIENTE_INTEGRACAO">AMBIENTE INTEGRAÇÃO</label>
                    </span>
                
                    <!-- Modo edição -->
                    <p-dropdown
                        *ngIf="editMode"
                        id="AMBIENTE_INTEGRACAO-dropdown"
                        [options]="webservicesDisponiveis"
                        [(ngModel)]="resultado.AMBIENTE_INTEGRACAO_ID"
                        optionLabel="NOME_CIDADE"
                        optionValue="ID"
                        placeholder="Selecione o WebService"
                        (onChange)="onAmbienteIntegracaoChange($event)">
                        <ng-template let-ws pTemplate="item">
                            <div>
                                <div>{{ws.NOME_CIDADE}}</div>
                                <small class="text-sm text-color-secondary">ID: {{ws.ID}}</small>
                            </div>
                        </ng-template>
                    </p-dropdown>
                </div>
                
                            <!-- Certificado Digital -->
                <div class="field col-12 md:col-2">
                    <span class="p-float-label float-label-fixed">
                    <p-fileUpload name="certificado" 
                                (onSelect)="onCertificadoSelecionado($event)"
                                [multiple]="false"
                                accept=".pfx,.p12"
                                maxFileSize="1000000"
                                mode="basic"
                                chooseLabel="Buscar Certificad."
                                chooseIcon="pi pi-search"
                                styleClass="p-button p-button-info"
                                [disabled]="!editMode">
                    </p-fileUpload>
                    <label>CERTIFICADO DIGITAL</label>
                    <small *ngIf="certificadoEnviado" class="text-sm text-color-success" style="display: block; margin-top: 5px;">
                        <i class="pi pi-check-circle"></i> CERTIFICADO ENVIADO
                    </small>
                    </span>
                </div>
                
                <!-- Senha do Certificado -->
                <div class="field col-12 md:col-2">
                    <span class="p-float-label float-label-fixed">
                    <input id="senha-certificado" type="text" pinputtext="" 
                            class="p-inputtext p-component p-element"
                            [value]="senhaCertificado ? '••••••••' : ''"
                            readonly
                            [style.backgroundColor]="'lightgray'">
                    <label for="senha-certificado">SENHA DO CERTIFICADO</label>
                    </span>
                </div>
                
                <!-- Data de Upload -->
                <div class="field col-12 md:col-2" *ngIf="dataUploadCertificado">
                    <span class="p-float-label float-label-fixed">
                    <input id="data-upload" type="text" pinputtext="" 
                            class="p-inputtext p-component p-element"
                            [value]="dataUploadCertificado | date: 'dd/MM/yyyy HH:mm'"
                            readonly
                            [style.backgroundColor]="'lightgray'">
                    <label for="data-upload">DATA DO UPLOAD</label>
                    </span>
                </div>

<!-- \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\////////////////////////////////////////////////////////////////-->
<!-- \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\////////////////////////////////////////////////////////////////-->
<!-- \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\CNAES/////////////////////////////////////////////////////////////-->
<!-- \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\////////////////////////////////////////////////////////////////-->
<!-- \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\////////////////////////////////////////////////////////////////-->
                

                <div class="field col-12">
                  <div class="card">
                    <h3 class="text-center" [ngStyle]="{backgroundColor:'var(--cyan-800)', color: 'var(--primary-color-text)', borderRadius: 'var(--border-radius)'}">
                      CNAE
                    </h3>
                    
                    <p-table [value]="cnaesDaEmpresa" 
                            styleClass="p-datatable-sm rounded-table"
                            [tableStyle]="{'min-width': '100%'}">
                      
                            <ng-template pTemplate="header">
                              <tr>
                                <th style="width: 120px; border-top-left-radius: 12px;">Código</th>
                                <th>Descrição</th>
                                <th *ngIf="editMode" style="width: 100px;">Ação</th>
                                <th style="width: 60px; border-top-right-radius: 12px;"> <!-- Ajuste importante aqui -->
                                  <p-button *ngIf="editMode"
                                          icon="pi pi-plus" 
                                          severity="success" 
                                          styleClass="p-button-rounded p-button-sm"
                                          (click)="abrirDialogoCnae()"
                                          tooltip="Adicionar CNAE"
                                          tooltipPosition="top">
                                  </p-button>
                                </th>
                              </tr>
                            </ng-template>
                      
                      <ng-template pTemplate="body" let-cnae>
                        <tr>
                          <td style="background: #ffffff;">{{cnae.COD_CNAE}}</td>
                          <td style="background: #ffffff;">{{cnae.DESC_CNAE || '-'}}</td>
                          <td *ngIf="editMode" class="text-center" style="background: #ffffff;">
                            <p-button icon="pi pi-trash" 
                                    severity="danger" 
                                    styleClass="p-button-sm"
                                    (click)="removerCnae(cnae.COD_CNAE)"
                                    tooltip="Remover CNAE"
                                    tooltipPosition="top">
                            </p-button>
                          </td>
                          <td style="background: #ffffff;"></td>
                        </tr>
                      </ng-template>
                      
                      <ng-template pTemplate="emptymessage">
                        <tr>
                          <td [attr.colspan]="editMode ? 4 : 3" class="text-center p-4" style="border-radius: 12px;">
                            <i class="pi pi-info-circle mr-2"></i>
                            {{'Nenhum CNAE vinculado' }}
                          </td>
                        </tr>
                      </ng-template>
                    </p-table>
                  </div>
                </div>
  
                    <p-dialog 
                    [(visible)]="mostrarDialogoCnae" 
                    [modal]="true" 
                    [style]="{ width: '70vw', maxWidth: '800px' }"
                    [draggable]="false" 
                    [resizable]="false"
                    header="Adicionar CNAE">
                    
                    <div class="p-fluid grid p-3">
                      <!-- Formulário de busca melhorado -->
                      <div class="field col-12 md:col-3">
                        <span class="float-label-fixed label">
                          <input id="codCnae-input" type="text" pInputText 
                                [(ngModel)]="codCnaeBusca" 
                                placeholder="Código CNAE"
                                (keydown.enter)="buscarCnaes()">
                        </span>
                      </div>
                      
                      <div class="field col-12 md:col-7">
                        <span class="float-label-fixed label">
                          <input id="descCnae-input" type="text" pInputText 
                                [(ngModel)]="descCnaeBusca" 
                                placeholder="Descrição CNAE"
                                (keydown.enter)="buscarCnaes()">
                        </span>
                      </div>
                      
                      <div class="field col-12 md:col-2 flex align-content-end">
                        <p-button 
                          icon="pi pi-search" 
                          label="Buscar" 
                          (click)="buscarCnaes()"
                          styleClass="p-button-primary w-full"
                          [loading]="carregandoCnaes">
                        </p-button>
                      </div>
                      
                      <!-- Resultados da busca -->
                      <div class="col-12 mt-3" *ngIf="cnaesEncontrados.length > 0">
                        <p-table 
                          [value]="cnaesEncontrados" 
                          [loading]="carregandoCnaes"
                          [paginator]="true" 
                          [rows]="5"
                          [rowsPerPageOptions]="[5,10,20]"
                          [tableStyle]="{'min-width': '100%'}"
                          styleClass="p-datatable-sm">
                          
                          <ng-template pTemplate="header">
                            <tr>
                              <th width="120px">Código</th>
                              <th>Descrição</th>
                              <th width="100px">Ação</th>
                            </tr>
                          </ng-template>
                          
                          <ng-template pTemplate="body" let-cnae>
                            <tr>
                              <td>{{cnae.COD_CNAE}}</td>
                              <td>{{cnae.DESC_CNAE}}</td>
                              <td class="text-center">
                                <p-button 
                                  icon="pi pi-plus" 
                                  severity="success" 
                                  (click)="selecionarCnaeParaAdicionar(cnae)"
                                  styleClass="p-button-sm"
                                  [disabled]="!editMode"
                                  tooltip="Adicionar este CNAE"
                                  tooltipPosition="top">
                                </p-button>
                              </td>
                            </tr>
                          </ng-template>
                          
                          <ng-template pTemplate="emptymessage">
                            <tr>
                              <td colspan="3" class="text-center p-4">
                                Nenhum resultado encontrado.
                              </td>
                            </tr>
                          </ng-template>
                        </p-table>
                      </div>
                    </div>
                  </p-dialog>
                       
<!-- \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\////////////////////////////////////////////////////////////////-->
<!-- \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\////////////////////////////////////////////////////////////////-->
<!-- \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ITEM LC/////////////////////////////////////////////////////////////-->
<!-- \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\////////////////////////////////////////////////////////////////-->
<!-- \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\////////////////////////////////////////////////////////////////-->
                

        <div class="field col-12">
          <div class="card">
            <h3 class="text-center" [ngStyle]="{backgroundColor:'var(--cyan-800)', color: 'var(--primary-color-text)', borderRadius: 'var(--border-radius)'}">
              ITEM LC
            </h3>
            
            <p-table [value]="ITEMLCsDaEmpresa" 
                    styleClass="p-datatable-sm rounded-table"
                    [tableStyle]="{'min-width': '100%'}">
              
                    <ng-template pTemplate="header">
                      <tr>
                        <th style="width: 120px; border-top-left-radius: 12px;">Código</th>
                        <th>Descrição</th>
                        <th *ngIf="editMode" style="width: 100px;">Ação</th>
                        <th style="width: 60px; border-top-right-radius: 12px;"> <!-- Ajuste importante aqui -->
                          <p-button *ngIf="editMode"
                                  icon="pi pi-plus" 
                                  severity="success" 
                                  styleClass="p-button-rounded p-button-sm"
                                  (click)="abrirDialogoITEMLC()"
                                  tooltip="Adicionar ITEM LC"
                                  tooltipPosition="top">
                          </p-button>
                        </th>
                      </tr>
                    </ng-template>
              
              <ng-template pTemplate="body" let-ITEMLC>
                <tr>
                  <td style="background: #ffffff;">{{ITEMLC.COD_ITEM_LC}}</td>
                  <td style="background: #ffffff;">{{ITEMLC.DESC_ITEM_LC || '-'}}</td>
                  <td *ngIf="editMode" class="text-center" style="background: #ffffff;">
                    <p-button icon="pi pi-trash" 
                            severity="danger" 
                            styleClass="p-button-sm"
                            (click)="removerITEMLC(ITEMLC.COD_ITEM_LC)"
                            tooltip="Remover ITEM LC"
                            tooltipPosition="top">
                    </p-button>
                  </td>
                  <td style="background: #ffffff;"></td>
                </tr>
              </ng-template>
              
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td [attr.colspan]="editMode ? 4 : 3" class="text-center p-4" style="border-radius: 12px;">
                    <i class="pi pi-info-circle mr-2"></i>
                    {{'Nenhum ITEM LC vinculado' }}
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>

            <p-dialog 
            [(visible)]="mostrarDialogoITEMLC" 
            [modal]="true" 
            [style]="{ width: '70vw', maxWidth: '800px' }"
            [draggable]="false" 
            [resizable]="false"
            header="Adicionar ITEM LC">
            
            <div class="p-fluid grid p-3">
              <!-- Formulário de busca melhorado -->
              <div class="field col-12 md:col-3">
                <span class="float-label-fixed label">
                  <input id="codITEMLC-input" type="text" pInputText 
                        [(ngModel)]="codITEMLCBusca" 
                        placeholder="Código ITEM LC"
                        (keydown.enter)="buscarITEMLCs()">
                </span>
              </div>
              
              <div class="field col-12 md:col-7">
                <span class="float-label-fixed label">
                  <input id="descITEMLC-input" type="text" pInputText 
                        [(ngModel)]="descITEMLCBusca" 
                        placeholder="Descrição ITEMLC"
                        (keydown.enter)="buscarITEMLCs()">
                </span>
              </div>
              
              <div class="field col-12 md:col-2 flex align-content-end">
                <p-button 
                  icon="pi pi-search" 
                  label="Buscar" 
                  (click)="buscarITEMLCs()"
                  styleClass="p-button-primary w-full"
                  [loading]="carregandoITEMLCs">
                </p-button>
              </div>
              
              <!-- Resultados da busca -->
              <div class="col-12 mt-3" *ngIf="ITEMLCsEncontrados.length > 0">
                <p-table 
                  [value]="ITEMLCsEncontrados" 
                  [loading]="carregandoITEMLCs"
                  [paginator]="true" 
                  [rows]="5"
                  [rowsPerPageOptions]="[5,10,20]"
                  [tableStyle]="{'min-width': '100%'}"
                  styleClass="p-datatable-sm">
                  
                  <ng-template pTemplate="header">
                    <tr>
                      <th width="120px">Código</th>
                      <th>Descrição</th>
                      <th width="100px">Ação</th>
                    </tr>
                  </ng-template>
                  
                  <ng-template pTemplate="body" let-ITEMLC>
                    <tr>
                      <td>{{ITEMLC.COD_ITEM_LC}}</td>
                      <td>{{ITEMLC.DESC_ITEM_LC}}</td>
                      <td class="text-center">
                        <p-button 
                          icon="pi pi-plus" 
                          severity="success" 
                          (click)="selecionarITEMLCParaAdicionar(ITEMLC)"
                          styleClass="p-button-sm"
                          [disabled]="!editMode"
                          tooltip="Adicionar este ITEM LC"
                          tooltipPosition="top">
                        </p-button>
                      </td>
                    </tr>
                  </ng-template>
                  
                  <ng-template pTemplate="emptymessage">
                    <tr>
                      <td colspan="3" class="text-center p-4">
                        Nenhum resultado encontrado.
                      </td>
                    </tr>
                  </ng-template>
                </p-table>
              </div>
            </div>
          </p-dialog>


<!-- \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\////////////////////////////////////////////////////////////////-->
<!-- \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\////////////////////////////////////////////////////////////////-->
<!-- \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ATIVIDADES///////////////////////////////////////////////////////////-->
<!-- \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\////////////////////////////////////////////////////////////////-->
<!-- \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\////////////////////////////////////////////////////////////////-->

              <div class="field col-12">
                <div class="card card-rounded">
                  <h3 class="text-center" [ngStyle]="{backgroundColor:'var(--cyan-800)', color: 'var(--primary-color-text)', borderRadius: 'var(--border-radius)'}">
                    ATIVIDADES (Código de Tributação Municipal)
                  </h3>
                  
                  <p-table [value]="codigosTributacaoDaEmpresa" 
                  [loading]="carregandoCodigosTributacaoDaEmpresa"
                  styleClass="p-datatable-sm rounded-table"
                  [tableStyle]="{'min-width': '100%'}">

                  <ng-template pTemplate="header">
                    <tr>
                      <th style="width: 120px; border-top-left-radius: 12px;">Código</th>
                      <th>Descrição</th>
                      <th *ngIf="editMode" style="width: 100px;">Ação</th>
                      <th style="width: 60px; border-top-right-radius: 12px;">
                        <p-button *ngIf="editMode"
                                icon="pi pi-plus" 
                                severity="success" 
                                styleClass="p-button-rounded p-button-sm"
                                (click)="abrirDialogoNovaAtividade()"
                                tooltip="Cadastrar Nova Atividade"
                                tooltipPosition="top">
                        </p-button>
                      </th>
                    </tr>
                  </ng-template>

              <ng-template pTemplate="body" let-codigo>
              <tr>
              <td style="background: #ffffff;">{{codigo.COD_ATIVIDADE}}</td>
              <td style="background: #ffffff;">{{codigo.DESC_ATIVIDADE || '-'}}</td>
              <td *ngIf="editMode" class="text-center" style="background: #ffffff;">
                <p-button icon="pi pi-trash" 
                          severity="danger" 
                          styleClass="p-button-sm"
                          (click)="removerCodigoTributacao(codigo.COD_ATIVIDADE)"
                          tooltip="Remover código"
                          tooltipPosition="top">
                </p-button>
              </td>
              </tr>
              </ng-template>

              <ng-template pTemplate="emptymessage">
              <tr>
              <td [attr.colspan]="editMode ? 3 : 2" class="text-center p-4" style="border-radius: 12px;">
                <i class="pi pi-info-circle mr-2"></i>
                {{ carregandoCodigosTributacaoDaEmpresa ? 'Carregando...' : 'Nenhum registro encontrado' }}
              </td>
              </tr>
              </ng-template>
              </p-table>
                  
                  <div *ngIf="mostrarAdicionarCodigoTributacao" class="p-fluid p-formgrid grid p-mt-2 p-p-3">
                    <div class="field col-12 md:col-3">
                      <span class="p-float-label">
                        <input id="codAtividade" type="text" pInputText 
                              [(ngModel)]="codigoTributacaoParaAdicionar.COD_ATIVIDADE" 
                              name="codAtividade" required>
                        <label for="codAtividade">Código *</label>
                      </span>
                    </div>
                    
                    <div class="field col-12 md:col-6">
                      <span class="p-float-label">
                        <input id="descAtividade" type="text" pInputText 
                              [(ngModel)]="codigoTributacaoParaAdicionar.DESC_ATIVIDADE" 
                              name="descAtividade">
                        <label for="descAtividade">Descrição</label>
                      </span>
                    </div>
                    
                    <div class="field col-12 md:col-3 flex align-items-end gap-2">
                      <p-button icon="pi pi-check" label="Adicionar" 
                                severity="success" (click)="adicionarCodigoTributacao()">
                      </p-button>
                      <p-button icon="pi pi-times" label="Cancelar" 
                                severity="secondary" (click)="mostrarAdicionarCodigoTributacao = false">
                      </p-button>
                    </div>
                  </div>
                </div>
              </div>

              <p-dialog 
                [(visible)]="mostrarDialogoNovaAtividade" 
                [modal]="true" 
                [style]="{ width: '50vw' }"
                [draggable]="false" 
                [resizable]="false"
                header="Cadastrar Nova Atividade">
                
                <div class="p-fluid grid p-3">
                  <!-- Formulário de cadastro -->
                  <div class="field col-12 md:col-3">
                    <span class="float-label-fixed label">
                      <input id="codAtividade-input" type="text" pInputText 
                            [(ngModel)]="novaAtividade.COD_ATIVIDADE" 
                            placeholder="Código da Atividade"
                            required>
                    </span>
                  </div>
                  
                  <div class="field col-12 md:col-7">
                    <span class="float-label-fixed label">
                      <input id="descAtividade-input" type="text" pInputText 
                            [(ngModel)]="novaAtividade.DESC_ATIVIDADE" 
                            placeholder="Descrição da Atividade">
                    </span>
                  </div>
                  
                  <div class="field col-12 md:col-2 flex align-content-end">
                    <p-button 
                      icon="pi pi-plus" 
                      label="Adicionar" 
                      (click)="adicionarNovaAtividade()"
                      styleClass="p-button-primary w-full"
                      [(ngModel)]="adicionarNovaAtividade">
                    </p-button>
                  </div>
                </div>
              </p-dialog>




                <!-- Botões Editar, Salvar e Excluir -->
                <!-- No grupo de botões, adicione: -->
                <div class="btn-group field col-12 md:col-3 flex flex-wrap gap-3 justify-content-center items-center" role="group" aria-label="Edit group">
                    <p-button *ngIf="!editMode" icon="pi pi-pencil" severity="info" label="Editar" (click)="editarEmpresa(resultado.CNPJ)"></p-button>
                    <p-button *ngIf="editMode" icon="pi pi-save" severity="success" label="Salvar" (click)="salvarEmpresa()"></p-button>
                    <p-button *ngIf="editMode" icon="pi pi-times" severity="warning" label="Cancelar Edição" (click)="cancelarEdicao()"></p-button>
                    <p-button *ngIf="!editMode" icon="pi pi-trash" severity="danger" label="Excluir" (click)="confirmarExclusao()"></p-button>
                </div>
            </div>
        </div>
    </div>
  </div>
  